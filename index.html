<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Panel Zada≈Ñ</title>
<style>
body { font-family: Arial; max-width: 800px; margin: auto; }
.hidden { display: none; }
textarea { width: 100%; height: 120px; }
.task { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
</style>
</head>
<body>

<h1>Panel Zada≈Ñ</h1>

<!-- LOGIN -->
<div id="loginBox">
  <input id="email" placeholder="email">
  <input id="password" type="password" placeholder="has≈Ço">
  <button onclick="login()">Zaloguj</button>
</div>

<!-- PANEL -->
<div id="panel" class="hidden">
  Zalogowano jako: <b id="who"></b>
  <button onclick="logout()">Wyloguj</button>

  <hr>

  <h3>Wy≈õlij zadanie (TYLKO mbecela)</h3>
  <input id="to" placeholder="login odbiorcy">
  <textarea id="text" maxlength="2000"></textarea>
  <br>
  <button onclick="sendTask()">Wy≈õlij</button>

  <hr>

  <h3>Twoje zadania</h3>
  <div id="tasks"></div>
</div>

<script type="module">
/* ================= FIREBASE ================= */

// üî¥ TU WKLEJ SWOJƒÑ KONFIGURACJƒò
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyACzVKOmFK87VJJvBGCW921yrxbpKgYEKU",
  authDomain: "iiitla-zadania.firebaseapp.com",
  projectId: "iiitla-zadania",
  storageBucket: "iiitla-zadania.firebasestorage.app",
  messagingSenderId: "753248383455",
  appId: "1:753248383455:web:f39ab717514c979913146a",
  measurementId: "G-9DQCJ8T5QQ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= LOGIN ================= */

window.login = async () => {
  await signInWithEmailAndPassword(
    auth,
    email.value,
    password.value
  );
};

window.logout = async () => {
  await signOut(auth);
};

onAuthStateChanged(auth, user => {
  if (!user) {
    loginBox.classList.remove("hidden");
    panel.classList.add("hidden");
    return;
  }

  const login = user.email.split("@")[0];

  who.textContent = login;
  loginBox.classList.add("hidden");
  panel.classList.remove("hidden");

  loadTasks(login);
});

/* ================= ZADANIA ================= */

function loadTasks(login) {
  const q = query(
    collection(db, "tasks"),
    where("to", "==", login),
    orderBy("created", "desc")
  );

  onSnapshot(q, snap => {
    tasks.innerHTML = "";
    let i = 1;
    snap.forEach(d => {
      const t = d.data();
      tasks.innerHTML += `
        <div class="task">
          <b>#${i++}</b><br>
          Od: ${t.from}<br><br>
          ${t.text}
        </div>
      `;
    });
  });
}

window.sendTask = async () => {
  const user = auth.currentUser;
  const login = user.email.split("@")[0];

  if (login !== "mbecela") {
    alert("Tylko mbecela mo≈ºe wysy≈Çaƒá zadania");
    return;
  }

  await addDoc(collection(db, "tasks"), {
    from: "mbecela",
    to: to.value.trim(),
    text: text.value,
    created: serverTimestamp()
  });

  text.value = "";
};
</script>

</body>
</html>

