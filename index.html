<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Zadania</title>
</head>
<body>

<h2>Logowanie</h2>
<div id="loginBox">
  Login: <input id="login"><br>
  Hasło: <input id="password" type="password"><br><br>
  <button onclick="login()">Zaloguj</button>
</div>

<div id="panel" style="display:none">
  Zalogowano jako: <b id="user"></b>
  <button onclick="logout()">Wyloguj</button>

  <hr>

  <!-- PANEL WYSYŁANIA (TYLKO mbecela) -->
  <div id="sender" style="display:none">
    <h3>Wyślij zadanie</h3>

    <select id="to">
      <option value="frzęsa">frzęsa</option>
      <option value="wbzowski">wbzowski</option>
      <option value="mchwałek">mchwałek</option>
      <option value="sciemny">sciemny</option>
      <option value="sgawlikowski">sgawlikowski</option>
      <option value="wgawlowska">wgawlowska</option>
      <option value="mkolodziej">mkolodziej</option>
      <option value="gkrzemińska">gkrzemińska</option>
      <option value="okurpik">okurpik</option>
      <option value="llipińska">llipińska</option>
      <option value="mrak">mrak</option>
      <option value="irzemyk">irzemyk</option>
      <option value="ssiudy">ssiudy</option>
      <option value="nsuska">nsuska</option>
    </select><br><br>

    <div id="task" contenteditable="true"
      style="border:1px solid black; min-height:100px;"></div><br>

    <button onclick="sendTask()">Wyślij</button>
    <hr>
  </div>

  <h3>Twoje zadania</h3>
  <div id="tasks"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, addDoc, query, where, orderBy, getDocs, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ===== TU WKLEJ SWOJE DANE Z FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyACzVKOmFK87VJJvBGCW921yrxbpKgYEKU",
  authDomain: "iiitla-zadania.firebaseapp.com",
  projectId: "iiitla-zadania",
  storageBucket: "iiitla-zadania.firebasestorage.app",
  messagingSenderId: "753248383455",
  appId: "1:753248383455:web:f39ab717514c979913146a",
  measurementId: "G-9DQCJ8T5QQ"
};
/* ======================================== */

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* LOGOWANIE */
window.login = async () => {
  const login = document.getElementById("login").value.trim();
  const pass = document.getElementById("password").value;
  await signInWithEmailAndPassword(auth, login + "@3tla.local", pass);
};

/* WYLOGOWANIE */
window.logout = async () => {
  await signOut(auth);
  location.reload();
};

/* PO ZALOGOWANIU */
onAuthStateChanged(auth, user => {
  if (!user) return;

  const login = user.email.split("@")[0];

  document.getElementById("loginBox").style.display = "none";
  document.getElementById("panel").style.display = "block";
  document.getElementById("user").innerText = login;

  if (login === "mbecela") {
    document.getElementById("sender").style.display = "block";
  }

  loadTasks(login);
});

/* WCZYTYWANIE ZADAŃ */
async function loadTasks(login) {
  const q = query(
    collection(db, "tasks"),
    where("to", "==", login),
    orderBy("created", "desc")
  );

  const snap = await getDocs(q);
  const box = document.getElementById("tasks");
  box.innerHTML = "";

  let i = 1;
  snap.forEach(doc => {
    const t = doc.data();
    box.innerHTML += `
      <div>
        <b>${i++}. Od ${t.from}</b><br>
        ${t.text}
        <hr>
      </div>
    `;
  });
}

/* WYSYŁANIE ZADAŃ */
window.sendTask = async () => {
  const to = document.getElementById("to").value.trim();
  const text = document.getElementById("task").innerHTML;

  await addDoc(collection(db, "tasks"), {
    from: "mbecela",
    to: to,
    text: text,
    created: serverTimestamp()
  });

  document.getElementById("task").innerHTML = "";
  alert("Zadanie wysłane");
};
</script>

</body>
</html>
